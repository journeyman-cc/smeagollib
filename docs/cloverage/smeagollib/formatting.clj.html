<html>
 <head>
   <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <link rel="stylesheet" href="../coverage.css"/>  <title> smeagollib/formatting.clj </title>
 </head>
 <body>
<span class="covered" title="1 out of 1 forms covered">
                001&nbsp;&nbsp;(ns&nbsp;^{:doc&nbsp;&quot;Format&nbsp;Semagol&#x27;s&nbsp;extended&nbsp;markdown&nbsp;format.&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:author&nbsp;&quot;Simon&nbsp;Brooke&quot;}
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                003&nbsp;&nbsp;&nbsp;&nbsp;smeagollib.formatting
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                004&nbsp;&nbsp;&nbsp;&nbsp;(:require&nbsp;[clojure.string&nbsp;:as&nbsp;cs]
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                005&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[markdown.core&nbsp;:as&nbsp;md]
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                006&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[smeagollib.configuration&nbsp;:refer&nbsp;[config]]
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                007&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[smeagollib.local-links&nbsp;:refer&nbsp;[local-links]]
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                008&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[taoensso.timbre&nbsp;:as&nbsp;log]))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                009&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                010&nbsp;&nbsp;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                011&nbsp;&nbsp;;;;;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                012&nbsp;&nbsp;;;;;&nbsp;Smeagol:&nbsp;a&nbsp;very&nbsp;simple&nbsp;Wiki&nbsp;engine.
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                013&nbsp;&nbsp;;;;;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                014&nbsp;&nbsp;;;;;&nbsp;This&nbsp;program&nbsp;is&nbsp;free&nbsp;software;&nbsp;you&nbsp;can&nbsp;redistribute&nbsp;it&nbsp;and&#x2F;or
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                015&nbsp;&nbsp;;;;;&nbsp;modify&nbsp;it&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                016&nbsp;&nbsp;;;;;&nbsp;as&nbsp;published&nbsp;by&nbsp;the&nbsp;Free&nbsp;Software&nbsp;Foundation;&nbsp;either&nbsp;version&nbsp;2
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                017&nbsp;&nbsp;;;;;&nbsp;of&nbsp;the&nbsp;License,&nbsp;or&nbsp;(at&nbsp;your&nbsp;option)&nbsp;any&nbsp;later&nbsp;version.
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                018&nbsp;&nbsp;;;;;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                019&nbsp;&nbsp;;;;;&nbsp;This&nbsp;program&nbsp;is&nbsp;distributed&nbsp;in&nbsp;the&nbsp;hope&nbsp;that&nbsp;it&nbsp;will&nbsp;be&nbsp;useful,
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                020&nbsp;&nbsp;;;;;&nbsp;but&nbsp;WITHOUT&nbsp;ANY&nbsp;WARRANTY;&nbsp;without&nbsp;even&nbsp;the&nbsp;implied&nbsp;warranty&nbsp;of
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                021&nbsp;&nbsp;;;;;&nbsp;MERCHANTABILITY&nbsp;or&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE.&nbsp;&nbsp;See&nbsp;the
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                022&nbsp;&nbsp;;;;;&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;for&nbsp;more&nbsp;details.
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                023&nbsp;&nbsp;;;;;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                024&nbsp;&nbsp;;;;;&nbsp;You&nbsp;should&nbsp;have&nbsp;received&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                025&nbsp;&nbsp;;;;;&nbsp;along&nbsp;with&nbsp;this&nbsp;program;&nbsp;if&nbsp;not,&nbsp;write&nbsp;to&nbsp;the&nbsp;Free&nbsp;Software
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                026&nbsp;&nbsp;;;;;&nbsp;Foundation,&nbsp;Inc.,&nbsp;51&nbsp;Franklin&nbsp;Street,&nbsp;Fifth&nbsp;Floor,&nbsp;Boston,&nbsp;MA&nbsp;&nbsp;02110-1301,
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                027&nbsp;&nbsp;;;;;&nbsp;USA.
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                028&nbsp;&nbsp;;;;;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                029&nbsp;&nbsp;;;;;&nbsp;Copyright&nbsp;(C)&nbsp;2017&nbsp;Simon&nbsp;Brooke
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                030&nbsp;&nbsp;;;;;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                031&nbsp;&nbsp;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                032&nbsp;&nbsp;;;;;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                033&nbsp;&nbsp;;;;;&nbsp;Right,&nbsp;doing&nbsp;the&nbsp;data&nbsp;visualisation&nbsp;thing&nbsp;is&nbsp;tricky.&nbsp;Doing&nbsp;it&nbsp;in&nbsp;the
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                034&nbsp;&nbsp;;;;;&nbsp;pipeline&nbsp;doesn&#x27;t&nbsp;work,&nbsp;because&nbsp;the&nbsp;md-to-html-string&nbsp;filter&nbsp;messes&nbsp;up
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                035&nbsp;&nbsp;;;;;&nbsp;both&nbsp;YAML&nbsp;and&nbsp;JSON&nbsp;notation.&nbsp;So&nbsp;we&nbsp;need&nbsp;to&nbsp;extract&nbsp;the&nbsp;visualisation
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                036&nbsp;&nbsp;;;;;&nbsp;fragments&nbsp;from&nbsp;the&nbsp;Markdown&nbsp;text&nbsp;and&nbsp;replace&nbsp;them&nbsp;with&nbsp;tokens&nbsp;we&nbsp;will
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                037&nbsp;&nbsp;;;;;&nbsp;recognise&nbsp;afterwards,&nbsp;perform&nbsp;md-to-html-string,&nbsp;and&nbsp;then&nbsp;replace&nbsp;our
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                038&nbsp;&nbsp;;;;;&nbsp;tokens&nbsp;with&nbsp;the&nbsp;transformed&nbsp;visualisation&nbsp;specification.
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                039&nbsp;&nbsp;;;;;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                040&nbsp;&nbsp;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                041&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="2 out of 2 forms covered">
                042&nbsp;&nbsp;(declare&nbsp;process-text)
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                043&nbsp;&nbsp;
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                044&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                045&nbsp;&nbsp;(defn&nbsp;process-backticks
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                046&nbsp;&nbsp;&nbsp;&nbsp;&quot;Effectively,&nbsp;escape&nbsp;the&nbsp;backticks&nbsp;surrounding&nbsp;this&nbsp;`text`,&nbsp;by&nbsp;protecting&nbsp;them
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                047&nbsp;&nbsp;&nbsp;&nbsp;from&nbsp;the&nbsp;`process-text`&nbsp;filter.
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                048&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                049&nbsp;&nbsp;&nbsp;&nbsp;**NOTE**&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;expected&nbsp;that&nbsp;this&nbsp;function&nbsp;forms&nbsp;part&nbsp;of&nbsp;a&nbsp;stable
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                050&nbsp;&nbsp;&nbsp;&nbsp;API.&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                051&nbsp;&nbsp;&nbsp;&nbsp;[^String&nbsp;text&nbsp;^Integer&nbsp;_]
                </span><br/>
<span class="not-covered" title="0 out of 5 forms covered">
                052&nbsp;&nbsp;&nbsp;&nbsp;(str&nbsp;&quot;&lt;pre&nbsp;class=\&quot;backticks\&quot;&gt;```&quot;&nbsp;(.trim&nbsp;text)&nbsp;&quot;\n```&lt;&#x2F;pre&gt;&quot;))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                053&nbsp;&nbsp;
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                054&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                055&nbsp;&nbsp;(defn&nbsp;get-first-token
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                056&nbsp;&nbsp;&nbsp;&nbsp;&quot;Return&nbsp;the&nbsp;first&nbsp;space-separated&nbsp;token&nbsp;of&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;this&nbsp;`string`,
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                057&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;`nil`&nbsp;if&nbsp;there&nbsp;is&nbsp;none.&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                058&nbsp;&nbsp;&nbsp;&nbsp;[^String&nbsp;string]
                </span><br/>
<span class="not-covered" title="0 out of 2 forms covered">
                059&nbsp;&nbsp;&nbsp;&nbsp;(try
                </span><br/>
<span class="not-covered" title="0 out of 13 forms covered">
                060&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(when&nbsp;string&nbsp;(first&nbsp;(cs&#x2F;split&nbsp;(first&nbsp;(cs&#x2F;split-lines&nbsp;string))&nbsp;#&quot;[^a-zA-Z0-9]+&quot;)))
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                061&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(catch&nbsp;NullPointerException&nbsp;_&nbsp;nil)))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                062&nbsp;&nbsp;
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                063&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                064&nbsp;&nbsp;(defn-&nbsp;process-markdown-fragment
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                065&nbsp;&nbsp;&nbsp;&nbsp;&quot;Within&nbsp;the&nbsp;context&nbsp;of&nbsp;`process-text`,&nbsp;process&nbsp;a&nbsp;fragment&nbsp;believed&nbsp;to&nbsp;be&nbsp;markdown.
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                066&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                067&nbsp;&nbsp;&nbsp;&nbsp;As&nbsp;with&nbsp;`process-text`,&nbsp;this&nbsp;function&nbsp;returns&nbsp;a&nbsp;map&nbsp;with&nbsp;two&nbsp;top-level&nbsp;keys:
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                068&nbsp;&nbsp;&nbsp;&nbsp;`:inclusions`,&nbsp;a&nbsp;map&nbsp;of&nbsp;constructed&nbsp;keywords&nbsp;to&nbsp;inclusion&nbsp;specifications,
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                069&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;`:text`,&nbsp;an&nbsp;HTML&nbsp;text&nbsp;string&nbsp;with&nbsp;the&nbsp;keywords&nbsp;present&nbsp;where&nbsp;the
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                070&nbsp;&nbsp;&nbsp;&nbsp;corresponding&nbsp;inclusion&nbsp;should&nbsp;be&nbsp;inserted.
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                071&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                072&nbsp;&nbsp;&nbsp;&nbsp;**NOTE**&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;expected&nbsp;that&nbsp;this&nbsp;function&nbsp;forms&nbsp;part&nbsp;of&nbsp;a&nbsp;stable
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                073&nbsp;&nbsp;&nbsp;&nbsp;API.&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                074&nbsp;&nbsp;&nbsp;&nbsp;[^Integer&nbsp;index&nbsp;^clojure.lang.Associative&nbsp;result&nbsp;^String&nbsp;fragment&nbsp;fragments&nbsp;processed]
                </span><br/>
<span class="not-covered" title="0 out of 2 forms covered">
                075&nbsp;&nbsp;&nbsp;&nbsp;(process-text
                </span><br/>
<span class="not-covered" title="0 out of 3 forms covered">
                076&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(inc&nbsp;index)
                </span><br/>
<span class="not-covered" title="0 out of 1 forms covered">
                077&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result
                </span><br/>
<span class="not-covered" title="0 out of 1 forms covered">
                078&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fragments
                </span><br/>
<span class="not-covered" title="0 out of 4 forms covered">
                079&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cons&nbsp;fragment&nbsp;processed)))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                080&nbsp;&nbsp;
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                081&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                082&nbsp;&nbsp;(defn&nbsp;deep-merge
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                083&nbsp;&nbsp;&nbsp;&nbsp;&quot;Cripped&nbsp;in&nbsp;its&nbsp;entirety&nbsp;from&nbsp;[here](https:&#x2F;&#x2F;clojuredocs.org&#x2F;clojure.core&#x2F;merge).&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                084&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[v&nbsp;&amp;&nbsp;vs]
                </span><br/>
<span class="not-covered" title="0 out of 1 forms covered">
                085&nbsp;&nbsp;&nbsp;&nbsp;(letfn&nbsp;[(rec-merge&nbsp;[v1&nbsp;v2]
                </span><br/>
<span class="not-covered" title="0 out of 11 forms covered">
                086&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(if&nbsp;(and&nbsp;(map?&nbsp;v1)&nbsp;(map?&nbsp;v2))
                </span><br/>
<span class="not-covered" title="0 out of 5 forms covered">
                087&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(merge-with&nbsp;deep-merge&nbsp;v1&nbsp;v2)
                </span><br/>
<span class="not-covered" title="0 out of 1 forms covered">
                088&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;v2))]
                </span><br/>
<span class="not-covered" title="0 out of 5 forms covered">
                089&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(if&nbsp;(some&nbsp;identity&nbsp;vs)
                </span><br/>
<span class="not-covered" title="0 out of 5 forms covered">
                090&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(reduce&nbsp;rec-merge&nbsp;v&nbsp;vs)
                </span><br/>
<span class="not-covered" title="0 out of 3 forms covered">
                091&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(last&nbsp;vs))))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                092&nbsp;&nbsp;
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                093&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                094&nbsp;&nbsp;(defn&nbsp;apply-formatter
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                095&nbsp;&nbsp;&nbsp;&nbsp;&quot;Within&nbsp;the&nbsp;context&nbsp;of&nbsp;`process-text`,&nbsp;process&nbsp;a&nbsp;fragment&nbsp;for&nbsp;which&nbsp;an&nbsp;explicit
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                096&nbsp;&nbsp;&nbsp;&nbsp;`formatter`&nbsp;has&nbsp;been&nbsp;identified,&nbsp;and&nbsp;then&nbsp;recurse&nbsp;back&nbsp;into&nbsp;`process-text`&nbsp;to
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                097&nbsp;&nbsp;&nbsp;&nbsp;process&nbsp;the&nbsp;remainder&nbsp;of&nbsp;the&nbsp;fragments.&nbsp;Arguments&nbsp;are&nbsp;as&nbsp;for&nbsp;`process-text`,&nbsp;q.v.,
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                098&nbsp;&nbsp;&nbsp;&nbsp;the&nbsp;addition&nbsp;of
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                099&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                100&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;`fragment`&nbsp;the&nbsp;current&nbsp;fragment&nbsp;to&nbsp;be&nbsp;processed;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                101&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;`token`&nbsp;the&nbsp;identifier&nbsp;of&nbsp;the&nbsp;extension&nbsp;processor&nbsp;to&nbsp;be&nbsp;applied;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                102&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;`formatter`&nbsp;the&nbsp;actual&nbsp;extension&nbsp;processor&nbsp;to&nbsp;be&nbsp;applied.
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                103&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                104&nbsp;&nbsp;&nbsp;&nbsp;As&nbsp;with&nbsp;`process-text`,&nbsp;this&nbsp;function&nbsp;returns&nbsp;a&nbsp;map&nbsp;with&nbsp;two&nbsp;top-level&nbsp;keys:
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                105&nbsp;&nbsp;&nbsp;&nbsp;`:inclusions`,&nbsp;a&nbsp;map&nbsp;of&nbsp;constructed&nbsp;keywords&nbsp;to&nbsp;inclusion&nbsp;specifications,
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                106&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;`:text`,&nbsp;an&nbsp;HTML&nbsp;text&nbsp;string&nbsp;with&nbsp;the&nbsp;keywords&nbsp;present&nbsp;where&nbsp;the
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                107&nbsp;&nbsp;&nbsp;&nbsp;corresponding&nbsp;inclusion&nbsp;should&nbsp;be&nbsp;inserted.
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                108&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                109&nbsp;&nbsp;&nbsp;&nbsp;**NOTE**&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;expected&nbsp;that&nbsp;this&nbsp;function&nbsp;forms&nbsp;part&nbsp;of&nbsp;a&nbsp;stable
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                110&nbsp;&nbsp;&nbsp;&nbsp;API.&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                111&nbsp;&nbsp;&nbsp;&nbsp;[^Integer&nbsp;index
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                112&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^clojure.lang.Associative&nbsp;result
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                113&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fragments
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                114&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processed
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                115&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^String&nbsp;fragment
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                116&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;^String&nbsp;token
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                117&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formatter]
                </span><br/>
<span class="not-covered" title="0 out of 1 forms covered">
                118&nbsp;&nbsp;&nbsp;&nbsp;(let
                </span><br/>
<span class="not-covered" title="0 out of 6 forms covered">
                119&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[inky&nbsp;(keyword&nbsp;(str&nbsp;&quot;inclusion-&quot;&nbsp;index))
                </span><br/>
<span class="not-covered" title="0 out of 3 forms covered">
                120&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;fkey&nbsp;(keyword&nbsp;token)]
                </span><br/>
<span class="not-covered" title="0 out of 2 forms covered">
                121&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(process-text
                </span><br/>
<span class="not-covered" title="0 out of 3 forms covered">
                122&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(inc&nbsp;index)
                </span><br/>
<span class="not-covered" title="0 out of 2 forms covered">
                123&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(deep-merge
                </span><br/>
<span class="not-covered" title="0 out of 1 forms covered">
                124&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result
                </span><br/>
<span class="not-covered" title="0 out of 17 forms covered">
                125&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{:inclusions&nbsp;{inky&nbsp;(eval&nbsp;(list&nbsp;formatter&nbsp;(subs&nbsp;fragment&nbsp;(count&nbsp;token))&nbsp;index))}
                </span><br/>
<span class="not-covered" title="0 out of 7 forms covered">
                126&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:extensions&nbsp;{fkey&nbsp;(-&gt;&nbsp;config&nbsp;:formatters&nbsp;fkey)}})
                </span><br/>
<span class="not-covered" title="0 out of 3 forms covered">
                127&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(rest&nbsp;fragments)
                </span><br/>
<span class="not-covered" title="0 out of 4 forms covered">
                128&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cons&nbsp;inky&nbsp;processed))))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                129&nbsp;&nbsp;
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                130&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                131&nbsp;&nbsp;(defn-&nbsp;reassemble-text
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                132&nbsp;&nbsp;&nbsp;&nbsp;&quot;Reassemble&nbsp;these&nbsp;processed&nbsp;strings&nbsp;into&nbsp;a&nbsp;complete&nbsp;text,&nbsp;and&nbsp;process&nbsp;it&nbsp;as
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                133&nbsp;&nbsp;&nbsp;&nbsp;Markdown.
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                134&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                135&nbsp;&nbsp;&nbsp;&nbsp;**NOTE**&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;expected&nbsp;that&nbsp;this&nbsp;function&nbsp;forms&nbsp;part&nbsp;of&nbsp;a&nbsp;stable
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                136&nbsp;&nbsp;&nbsp;&nbsp;API.&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                137&nbsp;&nbsp;&nbsp;&nbsp;[result&nbsp;processed]
                </span><br/>
<span class="not-covered" title="0 out of 4 forms covered">
                138&nbsp;&nbsp;&nbsp;&nbsp;(assoc&nbsp;result&nbsp;:text
                </span><br/>
<span class="not-covered" title="0 out of 2 forms covered">
                139&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(local-links
                </span><br/>
<span class="not-covered" title="0 out of 4 forms covered">
                140&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(md&#x2F;md-to-html-string
                </span><br/>
<span class="not-covered" title="0 out of 6 forms covered">
                141&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cs&#x2F;join&nbsp;&quot;\n\n&quot;&nbsp;(reverse&nbsp;processed))
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                142&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:heading-anchors&nbsp;true))))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                143&nbsp;&nbsp;
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                144&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                145&nbsp;&nbsp;(defn-&nbsp;reintegrate-inclusions
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                146&nbsp;&nbsp;&nbsp;&nbsp;&quot;Given&nbsp;a&nbsp;map&nbsp;of&nbsp;the&nbsp;form&nbsp;produced&nbsp;by&nbsp;`process-text`,&nbsp;return&nbsp;a&nbsp;map&nbsp;based&nbsp;on
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                147&nbsp;&nbsp;&nbsp;&nbsp;that&nbsp;map&nbsp;with&nbsp;the&nbsp;key&nbsp;`:content`&nbsp;bound&nbsp;to&nbsp;a&nbsp;string&nbsp;of&nbsp;HTML&nbsp;text
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                148&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;the&nbsp;inclusions&nbsp;(if&nbsp;any)&nbsp;generated&nbsp;by&nbsp;extension&nbsp;processors&nbsp;reintegrated.
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                149&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                150&nbsp;&nbsp;&nbsp;&nbsp;**NOTE**&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;expected&nbsp;that&nbsp;this&nbsp;function&nbsp;forms&nbsp;part&nbsp;of&nbsp;a&nbsp;stable
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                151&nbsp;&nbsp;&nbsp;&nbsp;API.&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                152&nbsp;&nbsp;&nbsp;&nbsp;([processed-text]
                </span><br/>
<span class="not-covered" title="0 out of 3 forms covered">
                153&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(assoc
                </span><br/>
<span class="not-covered" title="0 out of 1 forms covered">
                154&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;processed-text
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                155&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:content
                </span><br/>
<span class="not-covered" title="0 out of 2 forms covered">
                156&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(reintegrate-inclusions
                </span><br/>
<span class="not-covered" title="0 out of 3 forms covered">
                157&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(:inclusions&nbsp;processed-text)
                </span><br/>
<span class="not-covered" title="0 out of 3 forms covered">
                158&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(:text&nbsp;processed-text))))
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                159&nbsp;&nbsp;&nbsp;&nbsp;([inclusions&nbsp;text]
                </span><br/>
<span class="not-covered" title="0 out of 4 forms covered">
                160&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(let&nbsp;[ks&nbsp;(keys&nbsp;inclusions)]
                </span><br/>
<span class="not-covered" title="0 out of 6 forms covered">
                161&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(if&nbsp;(empty?&nbsp;(keys&nbsp;inclusions))
                </span><br/>
<span class="not-covered" title="0 out of 1 forms covered">
                162&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text
                </span><br/>
<span class="not-covered" title="0 out of 4 forms covered">
                163&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(let&nbsp;[kw&nbsp;(first&nbsp;ks)]
                </span><br/>
<span class="not-covered" title="0 out of 2 forms covered">
                164&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(reintegrate-inclusions
                </span><br/>
<span class="not-covered" title="0 out of 4 forms covered">
                165&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(dissoc&nbsp;inclusions&nbsp;kw)
                </span><br/>
<span class="not-covered" title="0 out of 2 forms covered">
                166&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cs&#x2F;replace
                </span><br/>
<span class="not-covered" title="0 out of 1 forms covered">
                167&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;text
                </span><br/>
<span class="not-covered" title="0 out of 3 forms covered">
                168&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(str&nbsp;kw)
                </span><br/>
<span class="not-covered" title="0 out of 7 forms covered">
                169&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cs&#x2F;replace&nbsp;(kw&nbsp;inclusions)&nbsp;&quot;\\&#x2F;&quot;&nbsp;&quot;&#x2F;&quot;))))))))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                170&nbsp;&nbsp;
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                171&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                172&nbsp;&nbsp;(defn-&nbsp;process-text
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                173&nbsp;&nbsp;&nbsp;&nbsp;&quot;Process&nbsp;extension&nbsp;fragments&nbsp;in&nbsp;this&nbsp;text.&nbsp;Arguments&nbsp;are:
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                174&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;`index`,&nbsp;the&nbsp;index&nbsp;number&nbsp;of&nbsp;the&nbsp;current&nbsp;fragment;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                175&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;`result`,&nbsp;a&nbsp;context&nbsp;within&nbsp;which&nbsp;the&nbsp;final&nbsp;result&nbsp;is&nbsp;being&nbsp;accumulated;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                176&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;`fragments`,&nbsp;a&nbsp;sequence&nbsp;of&nbsp;the&nbsp;fragments&nbsp;of&nbsp;the&nbsp;original&nbsp;text&nbsp;which&nbsp;have
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                177&nbsp;&nbsp;&nbsp;&nbsp;not&nbsp;yet&nbsp;been&nbsp;processed;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                178&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;`processed`,&nbsp;a&nbsp;reverse&nbsp;sequence&nbsp;of&nbsp;the&nbsp;fragments&nbsp;of&nbsp;the&nbsp;original&nbsp;text
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                179&nbsp;&nbsp;&nbsp;&nbsp;which&nbsp;have&nbsp;already&nbsp;been&nbsp;processed.
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                180&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                181&nbsp;&nbsp;&nbsp;&nbsp;Returns&nbsp;a&nbsp;map&nbsp;derived&nbsp;from&nbsp;`result`&nbsp;enhanced&nbsp;with&nbsp;the&nbsp;accumulated&nbsp;result.
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                182&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                183&nbsp;&nbsp;&nbsp;&nbsp;**NOTE**&nbsp;that&nbsp;it&nbsp;is&nbsp;not&nbsp;expected&nbsp;that&nbsp;this&nbsp;function&nbsp;forms&nbsp;part&nbsp;of&nbsp;a&nbsp;stable
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                184&nbsp;&nbsp;&nbsp;&nbsp;API.&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                185&nbsp;&nbsp;&nbsp;&nbsp;[^Integer&nbsp;index&nbsp;^clojure.lang.Associative&nbsp;result&nbsp;fragments&nbsp;processed]
                </span><br/>
<span class="not-covered" title="0 out of 4 forms covered">
                186&nbsp;&nbsp;&nbsp;&nbsp;(let&nbsp;[fragment&nbsp;(first&nbsp;fragments)
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                187&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;&nbsp;if&nbsp;I&nbsp;didn&#x27;t&nbsp;find&nbsp;a&nbsp;formatter&nbsp;for&nbsp;a&nbsp;back-tick&nbsp;marked&nbsp;fragment,
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                188&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;&nbsp;I&nbsp;need&nbsp;to&nbsp;put&nbsp;the&nbsp;backticks&nbsp;back&nbsp;in.
                </span><br/>
<span class="not-covered" title="0 out of 10 forms covered">
                189&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;remarked&nbsp;(if&nbsp;(odd?&nbsp;index)&nbsp;(str&nbsp;&quot;```&quot;&nbsp;fragment&nbsp;&quot;\n```&quot;)&nbsp;fragment)
                </span><br/>
<span class="not-covered" title="0 out of 3 forms covered">
                190&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;first-token&nbsp;(get-first-token&nbsp;fragment)
                </span><br/>
<span class="not-covered" title="0 out of 9 forms covered">
                191&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kw&nbsp;(when-not&nbsp;(empty?&nbsp;first-token)&nbsp;(keyword&nbsp;first-token))
                </span><br/>
<span class="not-covered" title="0 out of 2 forms covered">
                192&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formatter&nbsp;(when
                </span><br/>
<span class="not-covered" title="0 out of 1 forms covered">
                193&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;kw
                </span><br/>
<span class="not-covered" title="0 out of 2 forms covered">
                194&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(try
                </span><br/>
<span class="not-covered" title="0 out of 9 forms covered">
                195&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(read-string&nbsp;(-&gt;&nbsp;config&nbsp;:formatters&nbsp;kw&nbsp;:formatter))
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                196&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(catch&nbsp;Exception&nbsp;_
                </span><br/>
<span class="not-covered" title="0 out of 17 forms covered">
                197&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(log&#x2F;info&nbsp;&quot;No&nbsp;formatter&nbsp;found&nbsp;for&nbsp;extension&nbsp;`&quot;&nbsp;kw&nbsp;&quot;`&quot;)
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                198&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;&nbsp;no&nbsp;extension&nbsp;registered&nbsp;-&nbsp;there&nbsp;sometimes&nbsp;won&#x27;t&nbsp;be,
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                199&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;&nbsp;and&nbsp;it&nbsp;doesn&#x27;t&nbsp;matter
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                200&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;nil)))]
                </span><br/>
<span class="not-covered" title="0 out of 3 forms covered">
                201&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cond
                </span><br/>
<span class="not-covered" title="0 out of 3 forms covered">
                202&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(empty?&nbsp;fragments)
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                203&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;&nbsp;We&#x27;ve&nbsp;come&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;list&nbsp;of&nbsp;fragments.&nbsp;Reassemble&nbsp;them&nbsp;into
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                204&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;;&nbsp;a&nbsp;single&nbsp;HTML&nbsp;text&nbsp;and&nbsp;pass&nbsp;it&nbsp;back.
                </span><br/>
<span class="not-covered" title="0 out of 4 forms covered">
                205&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(reassemble-text&nbsp;result&nbsp;processed)
                </span><br/>
<span class="not-covered" title="0 out of 1 forms covered">
                206&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;formatter
                </span><br/>
<span class="not-covered" title="0 out of 9 forms covered">
                207&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(apply-formatter&nbsp;index&nbsp;result&nbsp;fragments&nbsp;processed&nbsp;fragment&nbsp;first-token&nbsp;formatter)
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                208&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:else
                </span><br/>
<span class="not-covered" title="0 out of 9 forms covered">
                209&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(process-markdown-fragment&nbsp;index&nbsp;result&nbsp;remarked&nbsp;(rest&nbsp;fragments)&nbsp;processed))))
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                210&nbsp;&nbsp;
                </span><br/>
<span class="covered" title="1 out of 1 forms covered">
                211&nbsp;&nbsp;(defn&nbsp;md-&gt;html
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                212&nbsp;&nbsp;&nbsp;&nbsp;&quot;Process&nbsp;the&nbsp;source&nbsp;text&nbsp;(assumed&nbsp;to&nbsp;be&nbsp;the&nbsp;value&nbsp;of&nbsp;the&nbsp;key&nbsp;`:source`&nbsp;in&nbsp;this
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                213&nbsp;&nbsp;&nbsp;&nbsp;`context`,&nbsp;expected&nbsp;to&nbsp;be&nbsp;a&nbsp;full&nbsp;HTTP&nbsp;request&nbsp;map,&nbsp;so&nbsp;that&nbsp;extensions&nbsp;may&nbsp;in
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                214&nbsp;&nbsp;&nbsp;&nbsp;future&nbsp;potentially&nbsp;have&nbsp;access&nbsp;to&nbsp;things&nbsp;like&nbsp;`accepts-*`&nbsp;headers.
                </span><br/>
<span class="blank" title="0 out of 0 forms covered">
                215&nbsp;&nbsp;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                216&nbsp;&nbsp;&nbsp;&nbsp;The&nbsp;source&nbsp;is&nbsp;assumed&nbsp;to&nbsp;be&nbsp;markdown&nbsp;potentially&nbsp;containing&nbsp;both&nbsp;local&nbsp;links
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                217&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;extension&nbsp;specifications,&nbsp;and&nbsp;return&nbsp;a&nbsp;map&nbsp;with&nbsp;top-level&nbsp;keys:
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                218&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;`:content`,&nbsp;the&nbsp;HTML&nbsp;content&nbsp;of&nbsp;the&nbsp;page&nbsp;to&nbsp;serve;&nbsp;and
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                219&nbsp;&nbsp;&nbsp;&nbsp;*&nbsp;`:extensions`,&nbsp;being&nbsp;a&nbsp;subset&nbsp;of&nbsp;the&nbsp;`:formatters`&nbsp;map&nbsp;from
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                220&nbsp;&nbsp;&nbsp;&nbsp;`smeagollib.configuration&#x2F;config`&nbsp;covering&nbsp;the&nbsp;extensions&nbsp;actually&nbsp;used&nbsp;in&nbsp;the
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                221&nbsp;&nbsp;&nbsp;&nbsp;generated&nbsp;content.&quot;
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                222&nbsp;&nbsp;&nbsp;&nbsp;[^clojure.lang.Associative&nbsp;context]
                </span><br/>
<span class="not-covered" title="0 out of 2 forms covered">
                223&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(reintegrate-inclusions
                </span><br/>
<span class="not-covered" title="0 out of 4 forms covered">
                224&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(process-text
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                225&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0
                </span><br/>
<span class="not-covered" title="0 out of 5 forms covered">
                226&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(assoc&nbsp;context&nbsp;:extensions&nbsp;#{})
                </span><br/>
<span class="not-covered" title="0 out of 11 forms covered">
                227&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(cs&#x2F;split&nbsp;(or&nbsp;(:source&nbsp;context)&nbsp;&quot;&quot;)&nbsp;#&quot;```&quot;)
                </span><br/>
<span class="not-tracked" title="0 out of 0 forms covered">
                228&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#x27;())))
                </span><br/>
 </body>
</html>
