<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>smeagollib.sanity documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Smeagollib</span> <span class="project-version">0.1.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="intro.html"><div class="inner"><span>smeagollib</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>smeagollib</span></div></div></li><li class="depth-2 branch"><a href="smeagollib.authenticate.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>authenticate</span></div></a></li><li class="depth-2 branch"><a href="smeagollib.configuration.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>configuration</span></div></a></li><li class="depth-2 branch"><a href="smeagollib.diff2html.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>diff2html</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>extensions</span></div></div></li><li class="depth-3 branch"><a href="smeagollib.extensions.geocsv.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>geocsv</span></div></a></li><li class="depth-3 branch"><a href="smeagollib.extensions.mermaid.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>mermaid</span></div></a></li><li class="depth-3 branch"><a href="smeagollib.extensions.photoswipe.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>photoswipe</span></div></a></li><li class="depth-3 branch"><a href="smeagollib.extensions.test.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>test</span></div></a></li><li class="depth-3 branch"><a href="smeagollib.extensions.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li><li class="depth-3"><a href="smeagollib.extensions.vega.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>vega</span></div></a></li><li class="depth-2 branch"><a href="smeagollib.finder.html"><div class="inner"><span class="tree" style="top: -207px;"><span class="top" style="height: 216px;"></span><span class="bottom"></span></span><span>finder</span></div></a></li><li class="depth-2 branch"><a href="smeagollib.formatting.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>formatting</span></div></a></li><li class="depth-2 branch"><a href="smeagollib.history.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>history</span></div></a></li><li class="depth-2"><a href="smeagollib.include.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>include</span></div></a></li><li class="depth-3 branch"><a href="smeagollib.include.indent.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>indent</span></div></a></li><li class="depth-3 branch"><a href="smeagollib.include.parse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>parse</span></div></a></li><li class="depth-3 branch"><a href="smeagollib.include.resolve.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>resolve</span></div></a></li><li class="depth-3"><a href="smeagollib.include.resolve-local-file.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>resolve-local-file</span></div></a></li><li class="depth-2 branch"><a href="smeagollib.layout.html"><div class="inner"><span class="tree" style="top: -145px;"><span class="top" style="height: 154px;"></span><span class="bottom"></span></span><span>layout</span></div></a></li><li class="depth-2 branch"><a href="smeagollib.local-links.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>local-links</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>routes</span></div></div></li><li class="depth-3 branch"><a href="smeagollib.routes.admin.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>admin</span></div></a></li><li class="depth-3"><a href="smeagollib.routes.wiki.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>wiki</span></div></a></li><li class="depth-2 branch current"><a href="smeagollib.sanity.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>sanity</span></div></a></li><li class="depth-2 branch"><a href="smeagollib.uploads.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>uploads</span></div></a></li><li class="depth-2"><a href="smeagollib.util.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>util</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="smeagollib.sanity.html#var-as-hiccup-footer"><div class="inner"><span>as-hiccup-footer</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-as-hiccup-head"><div class="inner"><span>as-hiccup-head</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-as-hiccup-header"><div class="inner"><span>as-hiccup-header</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-as-hiccup-see-doc"><div class="inner"><span>as-hiccup-see-doc</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-at-least-one-admin"><div class="inner"><span>check-at-least-one-admin</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-can-read"><div class="inner"><span>check-can-read</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-can-read-and-write"><div class="inner"><span>check-can-read-and-write</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-can-write"><div class="inner"><span>check-can-write</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-config"><div class="inner"><span>check-config</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-content-dir"><div class="inner"><span>check-content-dir</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-everything"><div class="inner"><span>check-everything</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-exists"><div class="inner"><span>check-exists</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-is-dir"><div class="inner"><span>check-is-dir</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-password-file"><div class="inner"><span>check-password-file</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-password-member"><div class="inner"><span>check-password-member</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-password-member-field"><div class="inner"><span>check-password-member-field</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-password-members"><div class="inner"><span>check-password-members</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-upload-dir"><div class="inner"><span>check-upload-dir</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-check-with-protection"><div class="inner"><span>check-with-protection</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-compound-check-results"><div class="inner"><span>compound-check-results</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-ExplanationPart"><div class="inner"><span>ExplanationPart</span></div></a></li><li class="depth-2"><a href="smeagollib.sanity.html#var-as-hiccup"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>as-hiccup</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-get-locale-messages"><div class="inner"><span>get-locale-messages</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-sanity-check-installation"><div class="inner"><span>sanity-check-installation</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-sanity-check-report"><div class="inner"><span>sanity-check-report</span></div></a></li><li class="depth-1"><a href="smeagollib.sanity.html#var-show-sanity-check-error"><div class="inner"><span>show-sanity-check-error</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">smeagollib.sanity</h1><div class="doc"><div class="markdown"><p>Functions related to sanity checks and error reporting in conditions where the environment may not be sane. Generally, the functions in this file are called (via <code>sanity-check-installation</code>, which is the only supported entry point) at first start-up.</p></div></div><div class="public anchor" id="var-as-hiccup-footer"><h3>as-hiccup-footer</h3><div class="usage"><code>(as-hiccup-footer _)</code></div><div class="doc"><div class="markdown"><p>Create and return a dummy hiccup footer. <code>messages</code> passed for consistency with other ‘as-hiccup’ functions but not used here.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L396">view source</a></div></div><div class="public anchor" id="var-as-hiccup-head"><h3>as-hiccup-head</h3><div class="usage"><code>(as-hiccup-head messages)</code></div><div class="doc"><div class="markdown"><p><strong>TODO</strong>: write docs</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L368">view source</a></div></div><div class="public anchor" id="var-as-hiccup-header"><h3>as-hiccup-header</h3><div class="usage"><code>(as-hiccup-header messages)</code></div><div class="doc"><div class="markdown"><p>Create and return a hiccup-formatted header wrapping these <code>messages</code>.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L375">view source</a></div></div><div class="public anchor" id="var-as-hiccup-see-doc"><h3>as-hiccup-see-doc</h3><div class="usage"><code>(as-hiccup-see-doc messages)</code></div><div class="doc"><div class="markdown"><p>Create and return a hiccup ‘refer to documentation’ paragraph, wrapping these <code>messages</code>.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L384">view source</a></div></div><div class="public anchor" id="var-check-at-least-one-admin"><h3>check-at-least-one-admin</h3><div class="usage"><code>(check-at-least-one-admin passwd-content)</code></div><div class="doc"><div class="markdown"><p>Check that there is at least one user in this <code>passwd-content</code> who has <code>:admin</code> set to <code>true</code>.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L197">view source</a></div></div><div class="public anchor" id="var-check-can-read"><h3>check-can-read</h3><div class="usage"><code>(check-can-read path problem-key)</code></div><div class="doc"><div class="markdown"><p>Check this <code>path</code> is readable. If so, return <code>true</code>; if not, return a map containing this <code>problem-key</code> bound to a list explaining the problem.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L79">view source</a></div></div><div class="public anchor" id="var-check-can-read-and-write"><h3>check-can-read-and-write</h3><div class="usage"><code>(check-can-read-and-write path problem-key)</code></div><div class="doc"><div class="markdown"><p>Check this <code>path</code> is both readable and writable. If so, return <code>true</code>; if not, return a map containing this <code>problem-key</code> bound to a list explaining the problem.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L106">view source</a></div></div><div class="public anchor" id="var-check-can-write"><h3>check-can-write</h3><div class="usage"><code>(check-can-write path problem-key)</code></div><div class="doc"><div class="markdown"><p>Check this <code>path</code> is writable. If so, return <code>true</code>; if not, return a map containing this <code>problem-key</code> bound to a list explaining the problem.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L69">view source</a></div></div><div class="public anchor" id="var-check-config"><h3>check-config</h3><div class="usage"><code>(check-config path)</code></div><div class="doc"><div class="markdown"><p>Check that the file at this <code>path</code> is a valid configuration file</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L222">view source</a></div></div><div class="public anchor" id="var-check-content-dir"><h3>check-content-dir</h3><div class="usage"><code>(check-content-dir path)</code><code>(check-content-dir)</code></div><div class="doc"><div class="markdown"><p>Check that <code>path</code> exists and is populated as a valid content directory. Return true if so, else a map of all problems found. If <code>path</code> is not supplied, default to the configured content directory.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L117">view source</a></div></div><div class="public anchor" id="var-check-everything"><h3>check-everything</h3><div class="usage"><code>(check-everything content-dir upload-dir config-path passwd-path)</code><code>(check-everything)</code></div><div class="doc"><div class="markdown"><p><strong>TODO</strong>: write docs</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L241">view source</a></div></div><div class="public anchor" id="var-check-exists"><h3>check-exists</h3><div class="usage"><code>(check-exists path problem-key)</code></div><div class="doc"><div class="markdown"><p>Check this <code>path</code> exists. If so, return <code>true</code>; if not, return a map containing this <code>problem-key</code> bound to a list explaining the problem.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L49">view source</a></div></div><div class="public anchor" id="var-check-is-dir"><h3>check-is-dir</h3><div class="usage"><code>(check-is-dir path problem-key)</code></div><div class="doc"><div class="markdown"><p>Check this <code>path</code> is a directory. If so, return <code>true</code>; if not, return a map containing this <code>problem-key</code> bound to a list explaining the problem.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L59">view source</a></div></div><div class="public anchor" id="var-check-password-file"><h3>check-password-file</h3><div class="usage"><code>(check-password-file path)</code></div><div class="doc"><div class="markdown"><p>Check that the file at this <code>path</code> is a valid passwd file.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L212">view source</a></div></div><div class="public anchor" id="var-check-password-member"><h3>check-password-member</h3><div class="usage"><code>(check-password-member member user-key problem-key)</code></div><div class="doc"><div class="markdown"><p>Check that this <code>member</code> map, expected to be an entry from the passwd file whose key was <code>user-key</code>, has all the required fields and if not return a problem explanation with this <code>problem-key</code>.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L165">view source</a></div></div><div class="public anchor" id="var-check-password-member-field"><h3>check-password-member-field</h3><div class="usage"><code>(check-password-member-field member field user-key problem-key)</code></div><div class="doc"><div class="markdown"><p>Check that this <code>member</code> map, expected to be an entry from the passwd file whose key was <code>user-key</code>, has this <code>field</code> and if not return a problem explanation with this <code>problem-key</code>.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L154">view source</a></div></div><div class="public anchor" id="var-check-password-members"><h3>check-password-members</h3><div class="usage"><code>(check-password-members passwd-content)</code></div><div class="doc"><div class="markdown"><p>Check that all entries in this <code>passwd-content</code> have the required fields.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L187">view source</a></div></div><div class="public anchor" id="var-check-upload-dir"><h3>check-upload-dir</h3><div class="usage"><code>(check-upload-dir path)</code><code>(check-upload-dir)</code></div><div class="doc"><div class="markdown"><p>Check that the upload directory at <code>path</code> (defaults to configured upload path) exists and is readable and writable; check that each of the configured thumbnail subdirectories also exists and is writable.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L135">view source</a></div></div><div class="public anchor" id="var-check-with-protection"><h3>check-with-protection</h3><div class="usage"><code>(check-with-protection check problem-key &amp; args)</code></div><div class="doc"><div class="markdown"><p>Apply this <code>check</code> to this <code>path</code> and <code>problem-key</code>; if no exception is thrown, return the result. If an exception is thrown, return a map comprising a problem-key bound to an explanation which includes the exception.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L89">view source</a></div></div><div class="public anchor" id="var-compound-check-results"><h3>compound-check-results</h3><div class="usage"><code>(compound-check-results &amp; results)</code></div><div class="doc"><div class="markdown"><p><strong>TODO</strong>: write docs</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L100">view source</a></div></div><div class="public anchor" id="var-ExplanationPart"><h3>ExplanationPart</h3><h4 class="type">protocol</h4><div class="usage"></div><div class="doc"><div class="markdown"><p>things which may be parts of explanations need mechanisms for reducing themselves to natural language where possible</p></div></div><div class="members"><h4>members</h4><div class="inner"><div class="public anchor" id="var-as-hiccup"><h3>as-hiccup</h3><div class="usage"><code>(as-hiccup this dictionary)</code></div><div class="doc"><div class="markdown"><p>Return <code>this</code> as a hiccup-formatted structure.</p></div></div></div></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L267">view source</a></div></div><div class="public anchor" id="var-get-locale-messages"><h3>get-locale-messages</h3><div class="usage"><code>(get-locale-messages)</code></div><div class="doc"><div class="markdown"><p>Get messages for the server-side locale.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L357">view source</a></div></div><div class="public anchor" id="var-sanity-check-installation"><h3>sanity-check-installation</h3><div class="usage"></div><div class="doc"><div class="markdown"><p><strong>TODO</strong>: write docs</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L449">view source</a></div></div><div class="public anchor" id="var-sanity-check-report"><h3>sanity-check-report</h3><div class="usage"><code>(sanity-check-report problems)</code></div><div class="doc"><div class="markdown"><p>Convert this <code>problem</code> report into a nicely formatted HTML page</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L413">view source</a></div></div><div class="public anchor" id="var-show-sanity-check-error"><h3>show-sanity-check-error</h3><div class="usage"><code>(show-sanity-check-error error)</code><code>(show-sanity-check-error)</code></div><div class="doc"><div class="markdown"><p>Generate an error page in a way which should work even when everything else is broken. If no argument is passed, run the sanity check and if it fails return page contents; if <code>error</code> is passed, just return page content describing the error.</p></div></div><div class="src-link"><a href="https://github.com/journeyman-cc/smeagollib/blob/master/src/smeagollib/sanity.clj#L452">view source</a></div></div></div></body></html>